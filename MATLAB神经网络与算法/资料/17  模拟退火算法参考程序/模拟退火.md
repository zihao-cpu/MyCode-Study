### 1. 距离矩阵计算

假设有 \( N \) 个城市，每个城市的坐标为 \( (x_i, y_i) \)，城市之间的距离矩阵 \( D \) 由下式给出：

$$
D_{ij} = \sqrt{(x_i - x_j)^2 + (y_i - y_j)^2}, \quad \text{对于} \, i \neq j
$$

其中 \( D_{ij} \) 表示城市 \( i \) 到城市 \( j \) 的距离。

### 2. 路径长度计算

对于给定的路径 \( S = (S_1, S_2, \dots, S_N) \)，路径的总长度 \( L(S) \) 为城市间距离的总和：

$$
L(S) = \sum_{i=1}^{N-1} D_{S_i, S_{i+1}} + D_{S_N, S_1}
$$

其中 \( S_i \) 是路径中的第 \( i \) 个城市，\( D_{S_i, S_{i+1}} \) 是城市 \( S_i \) 和 \( S_{i+1} \) 之间的距离。

### 3. Metropolis 算法

在每一步迭代中，生成一个新的解 \( S_2 \)（扰动现有路径 \( S_1 \)），并根据 Metropolis 法则决定是否接受新解：

- 计算新解的路径长度 \( L(S_2) \)。
- 计算能量差 \( \Delta E = L(S_2) - L(S_1) \)。
- 如果 \( \Delta E \leq 0 \)，则无条件接受新解。
- 否则，接受新解的概率为：

$$
P(\text{accept}) = \exp\left(-\frac{\Delta E}{T}\right)
$$

其中 \( T \) 是当前的温度。温度随迭代逐渐降低。

### 4. 温度更新

在每次迭代后，温度 \( T \) 会按照如下公式进行降温：

$$
T_{k+1} = q \cdot T_k
$$

其中 \( q \) 是降温系数，通常 \( 0 < q < 1 \)。

### 5. 最优路径选择

在每次迭代中，比较当前路径的长度与历史最优路径的长度。如果当前路径的长度更短，则更新最优路径。

$$
L_{\text{best}}(k) = \min(L(S_k), L_{\text{best}}(k-1))
$$

其中 \( S_k \) 是第 \( k \) 次迭代得到的路径，\( L_{\text{best}}(k) \) 是当前最优路径的长度。

### 6. 扰动操作

扰动操作 \( \text{NewAnswer}(S_1) \) 通过交换路径 \( S_1 \) 中的两个城市的位置来生成新的路径。假设路径 \( S_1 = (S_1, S_2, \dots, S_N) \)，通过随机选择两个城市 \( a_1, a_2 \)，交换它们的位置生成新的路径 \( S_2 \):

$$
S_2 = \text{swap}(S_1[a_1], S_1[a_2])
$$

这可以表示为：

$$
S_2 = (S_1[1], \dots, S_1[a_1-1], S_1[a_2], S_1[a_1+1], \dots, S_1[N])
$$
